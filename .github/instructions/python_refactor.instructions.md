---
applyTo: "**"
---

# Python 重构与封装规范（通用版）

触发重构（满足任一条就执行“诊断->计划->实施->自检”）：
- 一个文件/模块混了多类职责（算法/业务 + IO/硬件/网络 + 入口/CLI + 配置加载等）
- 修改一个需求经常牵扯多个无关模块（高耦合）
- scripts 被当库 import、或出现循环依赖
- “完整功能”无法以稳定 API 的方式被别的程序调用

拆分与解耦的目标形态（优先采用，避免过度设计）：
- core：纯业务/算法（不依赖硬件/网络/文件系统）
- adapters：IO/硬件/SDK/文件读写（薄层）
- entry：cli/apps/scripts（组装参数与依赖，调用 core）

硬性验收：
- 依赖方向：adapters/entry -> core；core 不得反向依赖 adapters/entry
- 对外 API 收敛：每个功能块只暴露少量入口（函数/类），内部细节私有化（_ 前缀）
- 可复用：核心能力可通过 `import <pkg>` 或 `from <pkg> import ...` 调用（不要让使用方 import 深层内部模块）
- 可验证：至少提供最小冒烟用例或最小单测（happy path）

限制：
- 不新增第三方依赖；不引入复杂抽象（只有当确实存在 ≥2 个实现需要替换时才考虑接口/ABC）
- 允许少量重复换清晰；重复 ≥3 处且逻辑稳定才抽象（DRY 有边界）
