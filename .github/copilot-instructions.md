# Repository-wide Copilot Instructions

目标：帮助我把仓库改得更工程化（更清晰的边界、更低耦合、更可复用），同时避免过度设计。

最高优先级（冲突时按此裁决）：
1) 正确性/不改变既有行为（除非任务明确要求改行为）
2) 可读性与可维护性（边界清晰、低耦合、高内聚）
3) 可验证性（能自检/能跑通） > 性能优化 > “看起来很高级”的架构

硬规则（必须遵守）：
- 禁止臆测：所有判断必须基于仓库现有文件与代码；找不到就写“未在仓库中找到”，并说明你查了哪里。
- 小步修改：一次只做一个热点/一个主题；每步完成后保持可 import/可运行。
- 允许移动/重命名文件，但必须同步修复：imports、入口调用方式、配置路径引用、文档中的运行说明（若受影响）。
- 不上复杂框架/插件系统/依赖注入（除非仓库已有且任务明确要求）。
- 产出必须可复查：描述改动时引用具体路径与关键符号（模块/类/函数）。

默认策略（可按任务放宽）：
- 默认优先“风险可控 + 完整闭环”：
	- 可以是小改动，也可以是大改动；关键是能解释清楚边界、影响面，并且有可验证的闭环。
	- 对于大范围变更/破坏式变更：必须分批推进（每批可回滚）、提供迁移映射与全库修引用清单，并在每批结束完成验证与清零检查。
- 如果改动的主要目的就是“长期可维护性显著提升”（例如高频变更点、反复出 bug 的边界、重复实现），鼓励提出并实施更结构化的方案；但必须明确收益、影响面与验证方式。

依赖策略（统一规则）：
- 允许新增第三方依赖（当收益明显时）：
  - 适用信号：能显著降低实现复杂度/缺陷概率、替代自研“隐形依赖”、或明显改善可维护性/可验证性。
  - 必须说明：为什么需要 / 替代方案 / 影响面（体积、许可证、平台兼容、性能、安全）/ 如何回滚或移除
  - 必须同步：更新依赖声明（如 pyproject.toml/锁文件）与最小验证（至少 happy path）

“可迁移仓库”模式（很重要）：
- 先做“事实自发现”，再下结论：优先从 README、pyproject.toml、Makefile/Taskfile、CI 配置、现有 scripts/tests 里找到
  - 入口/运行方式
  - 测试命令
  - 格式化/静态检查工具与配置（ruff/black/isort/mypy 等）
- 如果找到了明确命令或约定：优先遵循，并在输出中引用证据路径。
- 如果没找到：给出最小可复现的验证闭环（import 冒烟 / 最小运行路径 / 最小单测三选一），不要编造“存在某命令”。

仓库特定信息（可选，填你知道的；不知道就写 Unknown）：
- 如何运行（入口/命令）：Unknown
- 如何测试（pytest/脚本）：Unknown
- 关键目录约定（若已有）：Unknown

沟通约定：
- 如果需要我提供路径/入口/测试命令，请先给出你已找到的证据与候选项，再提出问题。