# 在线采集 + 3D 定位配置模板（纯软件触发，全字段）
#
# 说明：字段与 `src/tennis3d/config.py` 完全对齐。
# - 有默认值的字段：写出默认值
# - 必填但没有默认值的字段：使用占位符（<...>）
#
# 用法示例：
# - uv run python -m tennis3d.apps.online_mvs_localize --config examples/configs/templates/online_software_trigger_minimal.yaml

# MVS Python 示例绑定目录（MvImport，可选）：
mvimport_dir: ""

# MVS SDK 动态库目录（可选）。如果你的环境已配置好 PATH，可留空。
dll_dir: ""

# 相机序列号列表（必填，至少 1 个；多相机建议 2~4 个）
serials:
  - "<CAM1_SERIAL>"
  - "<CAM2_SERIAL>"

# 分组对齐策略：trigger_index|frame_num|sequence
# 一般在线采集推荐 frame_num。
group_by: frame_num

# 在线时间轴（默认值：frame_host_timestamp）
# - frame_host_timestamp：沿用原逻辑，用组内 frames[*].host_timestamp 中位数
# - dev_timestamp_mapping：启用在线滑窗映射（dev_timestamp -> host_ms），更贴近曝光时刻
time_sync_mode: frame_host_timestamp

# 以下为在线滑窗映射参数（均为默认值）。仅在 time_sync_mode=dev_timestamp_mapping 时会用到。
time_mapping_warmup_groups: 20
time_mapping_window_groups: 200
time_mapping_update_every_groups: 5
time_mapping_min_points: 20
time_mapping_hard_outlier_ms: 50.0

# 超时/缓存控制（ms/数量），用于避免一直等不到“齐组”导致的阻塞/内存增长
timeout_ms: 1000
group_timeout_ms: 1000
max_pending_groups: 256
max_groups: 0

# 标定文件
calib: data/calibration/example_triple_camera_calib.json

# 检测器后端：fake|color|rknn|pt
# 默认 detector=fake（只用于链路/冒烟）。真实使用通常会改成 pt，并填写 model 路径。
detector: fake
model: ""

min_score: 0.25
require_views: 2

# 多球鲁棒定位参数：
max_detections_per_camera: 10
max_reproj_error_px: 8.0
max_uv_match_dist_px: 25.0
merge_dist_m: 0.08

# 输出 JSONL（可选）。默认值：不写文件。
# - 置空（""）表示 None
# - 填路径则会持续追加写入
out_jsonl: ""

# 触发配置：
# - trigger_source=Software 且 master_serial 为空：所有相机都设为 Software，并对全部相机下发软触发
trigger:
  trigger_source: Software
  master_serial: ""
  soft_trigger_fps: 5.0

  # 以下字段是主从触发时会用到的“线配置”，软件触发可保持默认
  master_line_out: Line1
  master_line_source: ""
  master_line_mode: Output
  trigger_activation: RisingEdge
  trigger_cache_enable: false

# 可选：轨迹拟合后处理（curve v3）。默认 disabled。
curve:
  enabled: false
  compare_v2: false
  compare_v3_legacy: false
  max_tracks: 4
  association_dist_m: 0.6
  max_missed_s: 0.6
  min_dt_s: 0.000001
  corridor_y_min: 0.6
  corridor_y_max: 1.6
  corridor_y_step: 0.1
  conf_from: quality
  constant_conf: 1.0
  is_bot_fire: -1
